# <path to game directory>/addons/eventscripts/_engines/python/Lib/esutils/
# clients.py
# by Adam Cunnington

"""Provide a simple way to register and interact with clients possessing
various permission and/or immunity levels. Also provide generic functions to
test whether a user which can be offline possesses a given permission.

"""

import psyco
psyco.full()


__all__ = (
    "ClientsError",
    "Client",
    "Group",
	"is_user_authorised",
    "is_user_immune"
    )


class ClientsError(Exception):
    """General error encountered relating to esutils.clients"""


class Client(object):
    """Create a client that can have varying permissions."""

    clients = {}

    def __init__(self, steam_id, name):
        """Instantiate a client object.

        Arguments:
        steam_id - the steam ID of the client.
        name - the name of the client to be stored.

        """
        self.steam_id = steam_id
        self.name = name
        self.permissions = set()
        self.immunities = set()
        self.group = None
        self.clients[steam_id] = self


class Group(object):
    """Create a group that clients can be joined to."""

    def __init__(self, basename, verbose_name=None):
        """Instantiate a Group object.

        Arguments:
        permissions - the permissions the group should have.

        """
        self.basename = basename
        self.verbose_name = verbose_name or tools.format_verbose_name(basename)
        self.permissions = set()
        self.immunities = set()


def is_user_authorised(steam_id, permission=None):
	"""Check whether a particular steam ID exists in the clients dictionary.
    If so, check if they possess a specific permission.
	Return the boolean result.

	Arguments:
	steam_id - the steam ID of the user to be checked.
	permission (Keyword Default: None) - the permission name to be checked.

	"""
	if steam_id not in Client.clients:
		return False
	if permission is None:
		return True
	Client = Client.clients[steam_id]
	if Client.group is None:
		return permission in Client.permissions
	return permission in Client.group.permissions


def is_user_immune(steam_id, permission):
	"""Check whether a particular steam ID exists in the clients dictionary.
    If so, check if they possess a specific immunity.
	Return the boolean result.

	Arguments:
	steam_id - the steam ID of the user to be checked.
	permission - the permission name to be checked.

	"""
	if steam_id not in Client.clients:
		return False
	Client = Client.clients[steam_id]
	if Client.group is None:
		return permission in Client.immunities
	return permission in Client.group.immunities
